# Vercel Deployment Guide

## Sprint 1: Deployment Pipeline Setup

### Step 1: Create Vercel Account

1. Go to [vercel.com](https://vercel.com)
2. Sign up with GitHub account
3. Grant Vercel access to your repositories

### Step 2: Import Project

1. Click "Add New..." → "Project"
2. Select your Bawo repository
3. Framework Preset: **Next.js** (auto-detected)
4. Build Command: `npm run build` (default)
5. Output Directory: `.next` (default)
6. Install Command: `npm install` (default)

### Step 3: Configure Environment Variables

**Required Variables:**

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
```

**How to add:**
1. Settings → Environment Variables
2. Add each variable with name and value
3. Select environments: Production, Preview, Development

**Optional Variables (Sprint 4+):**
```env
NEXT_PUBLIC_CELO_RPC_URL=https://forno.celo.org
CELO_HOT_WALLET_PRIVATE_KEY=your-private-key-here
NEXT_PUBLIC_SELF_PROTOCOL_API_KEY=your-api-key-here
```

### Step 4: Deploy

1. Click "Deploy"
2. Wait 2-3 minutes for initial build
3. Visit deployment URL (e.g., `your-project.vercel.app`)

**Expected result:** Homepage with Bawo branding

### Step 5: Verify Deployment

**Check health endpoint:**
```bash
curl https://your-project.vercel.app/api/health
```

**Expected response:**
```json
{
  "status": "ok",
  "timestamp": "2026-01-28T20:00:00.000Z",
  "version": "0.1.0",
  "sprint": 1,
  "environment": "production"
}
```

### Step 6: Configure Automatic Deployments

**Production (main branch):**
- Push to `main` or `master` → auto-deploy to production
- URL: `your-project.vercel.app`

**Preview (PRs):**
- Open PR → auto-deploy to preview URL
- URL: `your-project-git-branch-name.vercel.app`
- Comment added to PR with preview link

**Branch protection (recommended):**
1. GitHub → Settings → Branches
2. Add rule for `main`
3. Require status checks: Vercel deployment
4. Require PR reviews before merging

### Step 7: Custom Domain (Optional)

1. Vercel Dashboard → Settings → Domains
2. Add custom domain (e.g., `bawo.work`)
3. Configure DNS:
   - Type: A
   - Name: @
   - Value: `76.76.21.21`
4. Wait for DNS propagation (5-30 minutes)
5. SSL certificate auto-generated by Vercel

## Performance Settings

### Edge Functions (Sprint 2+)

For low-latency in Africa:
1. Settings → Functions
2. Region: Washington, D.C. (iad1) - closest to Africa with Vercel
3. Enable edge runtime for API routes

### Caching

Next.js automatically configures optimal caching:
- Static pages: Cached at CDN edge
- API routes: No caching by default
- Images: Optimized via `next/image`

### Preview Deployments

**Automatic:**
- Every PR gets unique preview URL
- Comment added to PR with link
- Preview deleted when PR merged

**Manual:**
- Push to any branch → preview deployment
- View in Vercel dashboard

## Monitoring

### Build Logs

1. Vercel Dashboard → Deployments
2. Click deployment
3. View build logs and runtime logs

### Error Tracking

Vercel captures errors automatically:
1. Dashboard → Errors
2. View stack traces and request details

### Analytics (Optional - Sprint 6)

1. Enable Vercel Analytics (free tier)
2. View real user metrics:
   - Core Web Vitals
   - Real user monitoring
   - Geography distribution

## Troubleshooting

### Build Fails

**Error:** `Module not found` or `Type error`

**Fix:**
1. Run locally: `npm run build`
2. Fix errors
3. Commit and push
4. Vercel will auto-rebuild

### Environment Variables Not Working

**Error:** API calls fail with "Missing credentials"

**Fix:**
1. Verify variables in Vercel dashboard
2. Ensure `NEXT_PUBLIC_` prefix for client-side variables
3. Redeploy: Deployments → Click "..." → Redeploy

### Preview Deployment Not Created

**Error:** PR has no preview comment

**Fix:**
1. Check Vercel GitHub integration
2. Re-authenticate: Settings → Git → Reconnect
3. Close and reopen PR

### 404 on API Routes

**Error:** `/api/health` returns 404

**Fix:**
1. Check file exists: `app/api/health/route.ts`
2. Verify build output includes API routes
3. Check Vercel Functions tab for deployed functions

## Security

### Environment Variables

**Never commit:**
- `.env.local` (in .gitignore)
- Private keys
- Service role keys
- API secrets

**Safe to commit:**
- `.env.example` (template with no real values)
- `vercel.json` (configuration only)

### Rate Limiting (Sprint 6)

Vercel free tier limits:
- 100 GB bandwidth/month
- 6000 build minutes/month
- 100 serverless function invocations/day (hobby plan)

For production, upgrade to Pro plan.

## Cost Estimates

**Free Tier (MVP):**
- ✅ Unlimited preview deployments
- ✅ 100 GB bandwidth
- ✅ Automatic HTTPS
- ✅ Edge network

**Pro Plan ($20/month - Production):**
- More bandwidth
- Advanced analytics
- Team features
- Priority support

## Next Steps

- Sprint 2: Test MiniPay wallet detection on deployment
- Sprint 4: Configure Celo RPC endpoint
- Sprint 6: Enable PWA manifest and service workers

## Resources

- [Vercel Docs](https://vercel.com/docs)
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
